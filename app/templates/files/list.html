{% extends "base.html" %}

{% block title %}æ–‡ä»¶åˆ—è¡¨ - æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-0">
            <i class="bi bi-files"></i> æˆ‘çš„æ–‡ä»¶
        </h2>
        <p class="text-muted mb-0">ç®¡ç†æ‚¨ä¸Šä¼ çš„æ‰€æœ‰æ–‡ä»¶</p>
    </div>
    <div>
        <a href="{{ url_for('files.upload') }}" class="btn btn-primary">
            <i class="bi bi-cloud-upload"></i> ä¸Šä¼ æ–‡ä»¶
        </a>
    </div>
</div>

<!-- æœç´¢å’Œç­›é€‰ -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
        <form method="GET" action="{{ url_for('files.list') }}" class="row g-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" class="form-control" name="search" 
                           value="{{ search }}" placeholder="æœç´¢æ–‡ä»¶åã€é¡¹ç›®å·ã€è®¾å¤‡åç§°...">
                </div>
            </div>
            <div class="col-md-4">
                <select class="form-select" name="category">
                    <option value="">æ‰€æœ‰ç±»å‹</option>
                    <option value="file" {% if category == 'file' %}selected{% endif %}>ğŸ“„ æ–‡ä»¶</option>
                    <option value="image" {% if category == 'image' %}selected{% endif %}>ğŸ–¼ï¸ å›¾ç‰‡</option>
                    <option value="video" {% if category == 'video' %}selected{% endif %}>ğŸ¥ è§†é¢‘</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-outline-primary w-100">
                    <i class="bi bi-funnel"></i> ç­›é€‰
                </button>
            </div>
        </form>
    </div>
</div>

<!-- æ–‡ä»¶ç»Ÿè®¡ -->
{% if files.items %}
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card border-0 bg-primary text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.total }}</h4>
                <small>æ€»æ–‡ä»¶æ•°</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 bg-success text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.items | selectattr('category', 'equalto', 'image') | list | length }}</h4>
                <small>å›¾ç‰‡æ–‡ä»¶</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 bg-danger text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.items | selectattr('category', 'equalto', 'video') | list | length }}</h4>
                <small>è§†é¢‘æ–‡ä»¶</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 bg-info text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.items | selectattr('category', 'equalto', 'file') | list | length }}</h4>
                <small>æ–‡æ¡£æ–‡ä»¶</small>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- æ–‡ä»¶åˆ—è¡¨ -->
{% if files.items %}
<div class="card border-0 shadow-sm">
    <div class="card-header bg-white">
        <h6 class="mb-0">
            <i class="bi bi-list"></i> æ–‡ä»¶åˆ—è¡¨
            <span class="badge bg-primary ms-2">{{ files.total }} ä¸ªæ–‡ä»¶</span>
        </h6>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 5%;">ç±»å‹</th>
                        <th style="width: 25%;">æ–‡ä»¶å</th>
                        <th style="width: 15%;">é¡¹ç›®ä¿¡æ¯</th>
                        <th style="width: 15%;">è®¾å¤‡ä¿¡æ¯</th>
                        <th style="width: 10%;">å¤§å°</th>
                        <th style="width: 10%;">å®‰å…¨ç­‰çº§</th>
                        <th style="width: 12%;">ä¸Šä¼ æ—¶é—´</th>
                        <th style="width: 8%;">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files.items %}
                    <tr>
                        <td>
                            {% if file.category == 'file' %}
                                <i class="bi bi-file-earmark-text text-primary" title="æ–‡ä»¶"></i>
                            {% elif file.category == 'image' %}
                                <i class="bi bi-image text-success" title="å›¾ç‰‡"></i>
                            {% elif file.category == 'video' %}
                                <i class="bi bi-camera-video text-danger" title="è§†é¢‘"></i>
                            {% else %}
                                <i class="bi bi-file-earmark text-secondary" title="æœªçŸ¥"></i>
                            {% endif %}
                        </td>
                        <td>
                            <div>
                                <strong>{{ file.original_filename }}</strong>
                                <br>
                                <small class="text-muted">
                                    ä¿å­˜ä¸ºï¼š{{ file.filename }}
                                    {% if file.category == 'image' and file.image_number %}
                                        <br>ç¼–å·ï¼š{{ file.image_number }}
                                    {% elif file.category == 'video' and file.video_number %}
                                        <br>ç¼–å·ï¼š{{ file.video_number }}
                                    {% elif file.file_type %}
                                        <br>ç±»å‹ï¼š{{ file.file_type.upper() }}
                                    {% endif %}
                                </small>
                            </div>
                        </td>
                        <td>
                            {% if file.project_number %}
                                <div class="small">
                                    <strong>{{ file.project_number }}</strong>
                                    {% if file.product_type %}
                                        <br><span class="text-muted">{{ file.product_type }}</span>
                                    {% endif %}
                                </div>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if file.device_name %}
                                <div class="small">
                                    <strong>{{ file.device_name }}</strong>
                                    {% if file.product_material %}
                                        <br><span class="text-muted">{{ file.product_material }}</span>
                                    {% endif %}
                                </div>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-light text-dark">{{ file.format_file_size() }}</span>
                            {% if file.category == 'image' and file.image_quality %}
                                <br><small class="text-muted">{{ file.image_quality }}</small>
                            {% elif file.category == 'video' and file.video_quality %}
                                <br><small class="text-muted">{{ file.video_quality }}</small>
                            {% endif %}
                        </td>
                        <td>
                            {% if file.security_level %}
                                {% set level_colors = {
                                    'public': 'success',
                                    'internal': 'info', 
                                    'confidential': 'warning',
                                    'secret': 'danger',
                                    'top_secret': 'dark'
                                } %}
                                <span class="badge bg-{{ level_colors.get(file.security_level, 'secondary') }}">
                                    {{ file.get_security_level_display() }}
                                </span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ file.upload_time.strftime('%Y-%m-%d') }}</small>
                            <br>
                            <small class="text-muted">{{ file.upload_time.strftime('%H:%M') }}</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{{ url_for('files.download', file_id=file.id) }}" 
                                   class="btn btn-outline-primary btn-sm" title="ä¸‹è½½">
                                    <i class="bi bi-download"></i>
                                </a>
                                <button type="button" class="btn btn-outline-info btn-sm" 
                                        onclick="showFileInfo({{ file.id }})" title="è¯¦æƒ…">
                                    <i class="bi bi-info-circle"></i>
                                </button>
                                <button type="button" class="btn btn-outline-danger btn-sm" 
                                        onclick="deleteFile({{ file.id }}, '{{ file.original_filename }}')" title="åˆ é™¤">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- åˆ†é¡µ -->
{% if files.pages > 1 %}
<nav aria-label="æ–‡ä»¶åˆ—è¡¨åˆ†é¡µ" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if files.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('files.list', page=files.prev_num, search=search, category=category) }}">ä¸Šä¸€é¡µ</a>
            </li>
        {% endif %}
        
        {% for page_num in files.iter_pages() %}
            {% if page_num %}
                {% if page_num != files.page %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('files.list', page=page_num, search=search, category=category) }}">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                {% endif %}
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">â€¦</span>
                </li>
            {% endif %}
        {% endfor %}
        
        {% if files.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('files.list', page=files.next_num, search=search, category=category) }}">ä¸‹ä¸€é¡µ</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<!-- ç©ºçŠ¶æ€ -->
<div class="card border-0 shadow-sm">
    <div class="card-body text-center py-5">
        <i class="bi bi-folder2-open" style="font-size: 4rem; color: #6c757d;"></i>
        <h4 class="mt-3 mb-2">è¿˜æ²¡æœ‰ä¸Šä¼ ä»»ä½•æ–‡ä»¶</h4>
        <p class="text-muted mb-4">å¼€å§‹ä¸Šä¼ æ‚¨çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å§ï¼</p>
        <a href="{{ url_for('files.upload') }}" class="btn btn-primary">
            <i class="bi bi-cloud-upload"></i> ç«‹å³ä¸Šä¼ 
        </a>
    </div>
</div>
{% endif %}

<!-- æ–‡ä»¶è¯¦æƒ…æ¨¡æ€æ¡† -->
<div class="modal fade" id="fileInfoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-info-circle-fill text-primary"></i> æ–‡ä»¶è¯¦æƒ…
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="fileInfoLoading" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                    </div>
                    <p class="mt-2">æ­£åœ¨åŠ è½½æ–‡ä»¶è¯¦æƒ…...</p>
                </div>
                
                <div id="fileInfoContent" class="d-none">
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-file-earmark-text"></i> åŸºæœ¬ä¿¡æ¯</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">æ–‡ä»¶ç±»å‹</label>
                                    <span id="fileCategory" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">æ–‡ä»¶å¤§å°</label>
                                    <span id="fileSize" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">åŸå§‹æ–‡ä»¶å</label>
                                    <span id="originalFilename" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">ç³»ç»Ÿæ–‡ä»¶å</label>
                                    <span id="systemFilename" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">æ–‡ä»¶è·¯å¾„</label>
                                    <span id="filePath" class="fw-bold text-break"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ—¶é—´ä¿¡æ¯ -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-clock-history"></i> æ—¶é—´ä¿¡æ¯</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="small text-muted d-block">ä¸Šä¼ æ—¶é—´</label>
                                    <span id="uploadTime" class="fw-bold"></span>
                                </div>
                                <div class="col-md-4">
                                    <label class="small text-muted d-block">åˆ›å»ºæ—¶é—´</label>
                                    <span id="createTime" class="fw-bold"></span>
                                </div>
                                <div class="col-md-4">
                                    <label class="small text-muted d-block">ä¿®æ”¹æ—¶é—´</label>
                                    <span id="modifyTime" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å±æ€§ä¿¡æ¯ -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-tags"></i> å±æ€§ä¿¡æ¯</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">é¡¹ç›®ç¼–å·</label>
                                    <span id="projectNumber" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">è®¾å¤‡åç§°</label>
                                    <span id="deviceName" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">å†…å®¹è¯­è¨€</label>
                                    <span id="contentLanguage" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">å®‰å…¨ç­‰çº§</label>
                                    <span id="securityLevel" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">å¤‡æ³¨è¯´æ˜</label>
                                    <span id="remarks" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- äº§å“ä¿¡æ¯ï¼ˆä»…å›¾ç‰‡å’Œè§†é¢‘æ˜¾ç¤ºï¼‰ -->
                    <div id="productInfoCard" class="card mb-3 d-none">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-box"></i> äº§å“ä¿¡æ¯</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">äº§å“ç±»å‹</label>
                                    <span id="productType" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">äº§å“ç‰©æ–™</label>
                                    <span id="productMaterial" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å›¾ç‰‡ç‰¹æœ‰å±æ€§ -->
                    <div id="imageInfoCard" class="card mb-3 d-none">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-image"></i> å›¾ç‰‡å±æ€§</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">å›¾ç‰‡è´¨é‡</label>
                                    <span id="imageQuality" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">å›¾ç‰‡ç¼–å·</label>
                                    <span id="imageNumber" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è§†é¢‘ç‰¹æœ‰å±æ€§ -->
                    <div id="videoInfoCard" class="card mb-3 d-none">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-camera-video"></i> è§†é¢‘å±æ€§</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">è§†é¢‘è´¨é‡</label>
                                    <span id="videoQuality" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">è§†é¢‘ç¼–å·</label>
                                    <span id="videoNumber" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ–‡ä»¶çŠ¶æ€ -->
                    <div id="fileStatusAlert" class="alert d-none" role="alert">
                        <!-- æ–‡ä»¶çŠ¶æ€ä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showFileInfo(fileId) {
    // æ˜¾ç¤ºæ¨¡æ€æ¡†
    const modal = new bootstrap.Modal(document.getElementById('fileInfoModal'));
    modal.show();
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    document.getElementById('fileInfoLoading').classList.remove('d-none');
    document.getElementById('fileInfoContent').classList.add('d-none');
    
    // è·å–æ–‡ä»¶è¯¦æƒ…
    fetch(`/files/api/file_info/${fileId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // éšè—åŠ è½½çŠ¶æ€
            document.getElementById('fileInfoLoading').classList.add('d-none');
            document.getElementById('fileInfoContent').classList.remove('d-none');
            
            // æ›´æ–°åŸºæœ¬ä¿¡æ¯
            document.getElementById('fileCategory').textContent = data.category || '-';
            document.getElementById('fileSize').textContent = data.file_size || '-';
            document.getElementById('originalFilename').textContent = data.original_filename || '-';
            document.getElementById('systemFilename').textContent = data.system_filename || '-';
            document.getElementById('filePath').textContent = data.file_path || '-';
            
            // æ›´æ–°æ—¶é—´ä¿¡æ¯
            document.getElementById('uploadTime').textContent = data.upload_time || '-';
            document.getElementById('createTime').textContent = data.create_time || '-';
            document.getElementById('modifyTime').textContent = data.modify_time || '-';
            
            // æ›´æ–°å±æ€§ä¿¡æ¯
            document.getElementById('projectNumber').textContent = data.project_number || '-';
            document.getElementById('deviceName').textContent = data.device_name || '-';
            document.getElementById('contentLanguage').textContent = data.content_language || '-';
            document.getElementById('securityLevel').textContent = data.security_level || '-';
            document.getElementById('remarks').textContent = data.remarks || '-';
            
            // å¤„ç†äº§å“ä¿¡æ¯ï¼ˆä»…å›¾ç‰‡å’Œè§†é¢‘æ˜¾ç¤ºï¼‰
            const productInfoCard = document.getElementById('productInfoCard');
            if (data.product_type || data.product_material) {
                productInfoCard.classList.remove('d-none');
                document.getElementById('productType').textContent = data.product_type || '-';
                document.getElementById('productMaterial').textContent = data.product_material || '-';
            } else {
                productInfoCard.classList.add('d-none');
            }
            
            // å¤„ç†å›¾ç‰‡ç‰¹æœ‰å±æ€§
            const imageInfoCard = document.getElementById('imageInfoCard');
            if (data.image_quality || data.image_number) {
                imageInfoCard.classList.remove('d-none');
                document.getElementById('imageQuality').textContent = data.image_quality || '-';
                document.getElementById('imageNumber').textContent = data.image_number || '-';
            } else {
                imageInfoCard.classList.add('d-none');
            }
            
            // å¤„ç†è§†é¢‘ç‰¹æœ‰å±æ€§
            const videoInfoCard = document.getElementById('videoInfoCard');
            if (data.video_quality || data.video_number) {
                videoInfoCard.classList.remove('d-none');
                document.getElementById('videoQuality').textContent = data.video_quality || '-';
                document.getElementById('videoNumber').textContent = data.video_number || '-';
            } else {
                videoInfoCard.classList.add('d-none');
            }
            
            // æ˜¾ç¤ºæ–‡ä»¶çŠ¶æ€
            const statusAlert = document.getElementById('fileStatusAlert');
            if (data.file_exists) {
                statusAlert.classList.remove('alert-danger');
                statusAlert.classList.add('alert-success');
                statusAlert.innerHTML = '<i class="bi bi-check-circle"></i> æ–‡ä»¶çŠ¶æ€æ­£å¸¸ï¼Œå¯ä»¥ä¸‹è½½å’Œä½¿ç”¨';
            } else {
                statusAlert.classList.remove('alert-success');
                statusAlert.classList.add('alert-danger');
                statusAlert.innerHTML = '<i class="bi bi-exclamation-triangle"></i> è­¦å‘Šï¼šç‰©ç†æ–‡ä»¶å·²ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„';
            }
            statusAlert.classList.remove('d-none');
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('fileInfoLoading').classList.add('d-none');
            document.getElementById('fileInfoContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-circle"></i> åŠ è½½æ–‡ä»¶è¯¦æƒ…å¤±è´¥ï¼š${error.message}
                </div>
            `;
            document.getElementById('fileInfoContent').classList.remove('d-none');
        });
}

function deleteFile(fileId, fileName) {
    var confirmMessage = 'ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "' + fileName + '" å—ï¼Ÿ\n\nâš ï¸ æ³¨æ„ï¼šè¿™å°†åŒæ—¶åˆ é™¤ï¼š\nâ€¢ æ•°æ®åº“ä¸­çš„æ–‡ä»¶è®°å½•\nâ€¢ ç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼';
    
    if (confirm(confirmMessage)) {
        // åˆ›å»ºè¡¨å•å¹¶æäº¤
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '/files/delete/' + fileId;
        
        // æ·»åŠ åˆ é™¤ç‰©ç†æ–‡ä»¶çš„å‚æ•°ï¼ˆé»˜è®¤ä¸ºtrueï¼‰
        var deletePhysicalInput = document.createElement('input');
        deletePhysicalInput.type = 'hidden';
        deletePhysicalInput.name = 'delete_physical';
        deletePhysicalInput.value = 'true';
        form.appendChild(deletePhysicalInput);
        
        // æ·»åŠ CSRFä»¤ç‰Œï¼ˆå¦‚æœéœ€è¦ï¼‰
        var csrfToken = document.querySelector('meta[name=csrf-token]');
        if (csrfToken) {
            var csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrf_token';
            csrfInput.value = csrfToken.getAttribute('content');
            form.appendChild(csrfInput);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}

// è‡ªåŠ¨æäº¤æœç´¢è¡¨å•
document.querySelector('input[name="search"]').addEventListener('input', function() {
    clearTimeout(this.searchTimeout);
    var form = this.form;
    this.searchTimeout = setTimeout(function() {
        form.submit();
    }, 500);
});
</script>

<style>
.table th {
    border-top: none;
    font-weight: 600;
    font-size: 0.875rem;
    color: #495057;
}

.table td {
    vertical-align: middle;
    border-color: #f8f9fa;
}

.btn-group-sm .btn {
    padding: 0.25rem 0.4rem;
    font-size: 0.75rem;
}

.badge {
    font-size: 0.7rem;
}

.card-header {
    background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #dee2e6;
}

@media (max-width: 768px) {
    .table-responsive {
        font-size: 0.875rem;
    }
    
    .btn-group-sm .btn {
        padding: 0.2rem 0.3rem;
        font-size: 0.7rem;
    }
}

/* æ–‡ä»¶è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
.modal-body .card {
    border: none;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
}

.modal-body .card-header {
    background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #dee2e6;
}

.modal-body .card-header h6 {
    color: #495057;
    font-weight: 600;
}

.modal-body .small {
    color: #6c757d;
}

.modal-body .fw-bold {
    color: #212529;
}

.modal-body .alert {
    margin-bottom: 0;
}

.modal-body .bi {
    margin-right: 0.5rem;
}
</style>
{% endblock %} 