{% extends "base.html" %}

{% block title %}Êñá‰ª∂ÂàóË°® - Êñá‰ª∂ÁÆ°ÁêÜÁ≥ªÁªü{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-0">
            <i class="bi bi-files"></i> ÊàëÁöÑÊñá‰ª∂
        </h2>
        <p class="text-muted mb-0">ÁÆ°ÁêÜÊÇ®‰∏ä‰º†ÁöÑÊâÄÊúâÊñá‰ª∂</p>
    </div>
    <div>
        <a href="{{ url_for('files.upload') }}" class="btn btn-primary">
            <i class="bi bi-cloud-upload"></i> ‰∏ä‰º†Êñá‰ª∂
        </a>
    </div>
</div>

<!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâ -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
        <form method="GET" action="{{ url_for('files.list') }}" class="row g-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" class="form-control" name="search" 
                           value="{{ search }}" placeholder="ÊêúÁ¥¢Êñá‰ª∂Âêç„ÄÅÈ°πÁõÆÂè∑„ÄÅËÆæÂ§áÂêçÁß∞...">
                </div>
            </div>
            <div class="col-md-4">
                <select class="form-select" name="category">
                    <option value="">ÊâÄÊúâÁ±ªÂûã</option>
                    <option value="file" {% if category == 'file' %}selected{% endif %}>üìÑ Êñá‰ª∂</option>
                    <option value="image" {% if category == 'image' %}selected{% endif %}>üñºÔ∏è ÂõæÁâá</option>
                    <option value="video" {% if category == 'video' %}selected{% endif %}>üé• ËßÜÈ¢ë</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-outline-primary w-100">
                    <i class="bi bi-funnel"></i> Á≠õÈÄâ
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Êñá‰ª∂ÁªüËÆ° -->
{% if files.items %}
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card border-0 bg-primary text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.total }}</h4>
                <small>ÊÄªÊñá‰ª∂Êï∞</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 bg-success text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.items | selectattr('category', 'equalto', 'image') | list | length }}</h4>
                <small>ÂõæÁâáÊñá‰ª∂</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 bg-danger text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.items | selectattr('category', 'equalto', 'video') | list | length }}</h4>
                <small>ËßÜÈ¢ëÊñá‰ª∂</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 bg-info text-white">
            <div class="card-body text-center">
                <h4 class="mb-0">{{ files.items | selectattr('category', 'equalto', 'file') | list | length }}</h4>
                <small>ÊñáÊ°£Êñá‰ª∂</small>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Êñá‰ª∂ÂàóË°® -->
{% if files.items %}
<div class="card border-0 shadow-sm">
    <div class="card-header bg-white">
        <h6 class="mb-0">
            <i class="bi bi-list"></i> Êñá‰ª∂ÂàóË°®
            <span class="badge bg-primary ms-2">{{ files.total }} ‰∏™Êñá‰ª∂</span>
        </h6>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 5%;">Á±ªÂûã</th>
                        <th style="width: 25%;">Êñá‰ª∂Âêç</th>
                        <th style="width: 15%;">È°πÁõÆ‰ø°ÊÅØ</th>
                        <th style="width: 15%;">ËÆæÂ§á‰ø°ÊÅØ</th>
                        <th style="width: 10%;">Â§ßÂ∞è</th>
                        <th style="width: 10%;">ÂÆâÂÖ®Á≠âÁ∫ß</th>
                        <th style="width: 12%;">‰∏ä‰º†Êó∂Èó¥</th>
                        <th style="width: 8%;">Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files.items %}
                    <tr>
                        <td>
                            {% if file.category == 'file' %}
                                <i class="bi bi-file-earmark-text text-primary" title="Êñá‰ª∂"></i>
                            {% elif file.category == 'image' %}
                                <i class="bi bi-image text-success" title="ÂõæÁâá"></i>
                            {% elif file.category == 'video' %}
                                <i class="bi bi-camera-video text-danger" title="ËßÜÈ¢ë"></i>
                            {% else %}
                                <i class="bi bi-file-earmark text-secondary" title="Êú™Áü•"></i>
                            {% endif %}
                        </td>
                        <td>
                            <div>
                                <strong>{{ file.original_filename }}</strong>
                                <br>
                                <small class="text-muted">
                                    ‰øùÂ≠ò‰∏∫Ôºö{{ file.filename }}
                                    {% if file.category == 'image' and file.image_number %}
                                        <br>ÁºñÂè∑Ôºö{{ file.image_number }}
                                    {% elif file.category == 'video' and file.video_number %}
                                        <br>ÁºñÂè∑Ôºö{{ file.video_number }}
                                    {% elif file.file_type %}
                                        <br>Á±ªÂûãÔºö{{ file.file_type.upper() }}
                                    {% endif %}
                                </small>
                            </div>
                        </td>
                        <td>
                            {% if file.project_number %}
                                <div class="small">
                                    <strong>{{ file.project_number }}</strong>
                                    {% if file.product_type %}
                                        <br><span class="text-muted">{{ file.product_type }}</span>
                                    {% endif %}
                                </div>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if file.device_name %}
                                <div class="small">
                                    <strong>{{ file.device_name }}</strong>
                                    {% if file.product_material %}
                                        <br><span class="text-muted">{{ file.product_material }}</span>
                                    {% endif %}
                                </div>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-light text-dark">{{ file.format_file_size() }}</span>
                            {% if file.category == 'image' and file.image_quality %}
                                <br><small class="text-muted">{{ file.image_quality }}</small>
                            {% elif file.category == 'video' and file.video_quality %}
                                <br><small class="text-muted">{{ file.video_quality }}</small>
                            {% endif %}
                        </td>
                        <td>
                            {% if file.security_level %}
                                {% set level_colors = {
                                    'public': 'success',
                                    'internal': 'info', 
                                    'confidential': 'warning',
                                    'secret': 'danger',
                                    'top_secret': 'dark'
                                } %}
                                <span class="badge bg-{{ level_colors.get(file.security_level, 'secondary') }}">
                                    {{ file.get_security_level_display() }}
                                </span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ file.upload_time.strftime('%Y-%m-%d') }}</small>
                            <br>
                            <small class="text-muted">{{ file.upload_time.strftime('%H:%M') }}</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{{ url_for('files.download', file_id=file.id) }}" 
                                   class="btn btn-outline-primary btn-sm" title="‰∏ãËΩΩ">
                                    <i class="bi bi-download"></i>
                                </a>
                                <button type="button" class="btn btn-outline-info btn-sm" 
                                        onclick="showFileInfo({{ file.id }})" title="ËØ¶ÊÉÖ">
                                    <i class="bi bi-info-circle"></i>
                                </button>
                                <button type="button" class="btn btn-outline-danger btn-sm" 
                                        onclick="deleteFile({{ file.id }}, '{{ file.original_filename }}')" title="Âà†Èô§">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ÂàÜÈ°µ -->
{% if files.pages > 1 %}
<nav aria-label="Êñá‰ª∂ÂàóË°®ÂàÜÈ°µ" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if files.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('files.list', page=files.prev_num, search=search, category=category) }}">‰∏ä‰∏ÄÈ°µ</a>
            </li>
        {% endif %}
        
        {% for page_num in files.iter_pages() %}
            {% if page_num %}
                {% if page_num != files.page %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('files.list', page=page_num, search=search, category=category) }}">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                {% endif %}
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">‚Ä¶</span>
                </li>
            {% endif %}
        {% endfor %}
        
        {% if files.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('files.list', page=files.next_num, search=search, category=category) }}">‰∏ã‰∏ÄÈ°µ</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<!-- Á©∫Áä∂ÊÄÅ -->
<div class="card border-0 shadow-sm">
    <div class="card-body text-center py-5">
        <i class="bi bi-folder2-open" style="font-size: 4rem; color: #6c757d;"></i>
        <h4 class="mt-3 mb-2">ËøòÊ≤°Êúâ‰∏ä‰º†‰ªª‰ΩïÊñá‰ª∂</h4>
        <p class="text-muted mb-4">ÂºÄÂßã‰∏ä‰º†ÊÇ®ÁöÑÁ¨¨‰∏Ä‰∏™Êñá‰ª∂ÂêßÔºÅ</p>
        <a href="{{ url_for('files.upload') }}" class="btn btn-primary">
            <i class="bi bi-cloud-upload"></i> Á´ãÂç≥‰∏ä‰º†
        </a>
    </div>
</div>
{% endif %}

<!-- Êñá‰ª∂ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
<div class="modal fade" id="fileInfoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-info-circle-fill text-primary"></i> Êñá‰ª∂ËØ¶ÊÉÖ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="fileInfoLoading" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Âä†ËΩΩ‰∏≠...</span>
                    </div>
                    <p class="mt-2">Ê≠£Âú®Âä†ËΩΩÊñá‰ª∂ËØ¶ÊÉÖ...</p>
                </div>
                
                <div id="fileInfoContent" class="d-none">
                    <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-file-earmark-text"></i> Âü∫Êú¨‰ø°ÊÅØ</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">Êñá‰ª∂Á±ªÂûã</label>
                                    <span id="fileCategory" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">Êñá‰ª∂Â§ßÂ∞è</label>
                                    <span id="fileSize" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">ÂéüÂßãÊñá‰ª∂Âêç</label>
                                    <span id="originalFilename" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">Á≥ªÁªüÊñá‰ª∂Âêç</label>
                                    <span id="systemFilename" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">Êñá‰ª∂Ë∑ØÂæÑ</label>
                                    <span id="filePath" class="fw-bold text-break"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Êó∂Èó¥‰ø°ÊÅØ -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-clock-history"></i> Êó∂Èó¥‰ø°ÊÅØ</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="small text-muted d-block">‰∏ä‰º†Êó∂Èó¥</label>
                                    <span id="uploadTime" class="fw-bold"></span>
                                </div>
                                <div class="col-md-4">
                                    <label class="small text-muted d-block">ÂàõÂª∫Êó∂Èó¥</label>
                                    <span id="createTime" class="fw-bold"></span>
                                </div>
                                <div class="col-md-4">
                                    <label class="small text-muted d-block">‰øÆÊîπÊó∂Èó¥</label>
                                    <span id="modifyTime" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Â±ûÊÄß‰ø°ÊÅØ -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-tags"></i> Â±ûÊÄß‰ø°ÊÅØ</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">È°πÁõÆÁºñÂè∑</label>
                                    <span id="projectNumber" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">ËÆæÂ§áÂêçÁß∞</label>
                                    <span id="deviceName" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">ÂÜÖÂÆπËØ≠Ë®Ä</label>
                                    <span id="contentLanguage" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">ÂÆâÂÖ®Á≠âÁ∫ß</label>
                                    <span id="securityLevel" class="fw-bold"></span>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted d-block">Â§áÊ≥®ËØ¥Êòé</label>
                                    <span id="remarks" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‰∫ßÂìÅ‰ø°ÊÅØÔºà‰ªÖÂõæÁâáÂíåËßÜÈ¢ëÊòæÁ§∫Ôºâ -->
                    <div id="productInfoCard" class="card mb-3 d-none">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-box"></i> ‰∫ßÂìÅ‰ø°ÊÅØ</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">‰∫ßÂìÅÁ±ªÂûã</label>
                                    <span id="productType" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">‰∫ßÂìÅÁâ©Êñô</label>
                                    <span id="productMaterial" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÂõæÁâáÁâπÊúâÂ±ûÊÄß -->
                    <div id="imageInfoCard" class="card mb-3 d-none">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-image"></i> ÂõæÁâáÂ±ûÊÄß</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">ÂõæÁâáË¥®Èáè</label>
                                    <span id="imageQuality" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">ÂõæÁâáÁºñÂè∑</label>
                                    <span id="imageNumber" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ËßÜÈ¢ëÁâπÊúâÂ±ûÊÄß -->
                    <div id="videoInfoCard" class="card mb-3 d-none">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-camera-video"></i> ËßÜÈ¢ëÂ±ûÊÄß</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">ËßÜÈ¢ëË¥®Èáè</label>
                                    <span id="videoQuality" class="fw-bold"></span>
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted d-block">ËßÜÈ¢ëÁºñÂè∑</label>
                                    <span id="videoNumber" class="fw-bold"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Êñá‰ª∂Áä∂ÊÄÅ -->
                    <div id="fileStatusAlert" class="alert d-none" role="alert">
                        <!-- Êñá‰ª∂Áä∂ÊÄÅ‰ø°ÊÅØÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÊ∑ªÂä† -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showFileInfo(fileId) {
    // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
    const modal = new bootstrap.Modal(document.getElementById('fileInfoModal'));
    modal.show();
    
    // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
    document.getElementById('fileInfoLoading').classList.remove('d-none');
    document.getElementById('fileInfoContent').classList.add('d-none');
    
    // Ëé∑ÂèñÊñá‰ª∂ËØ¶ÊÉÖ
    fetch(`/files/api/file_info/${fileId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
            document.getElementById('fileInfoLoading').classList.add('d-none');
            document.getElementById('fileInfoContent').classList.remove('d-none');
            
            // Êõ¥Êñ∞Âü∫Êú¨‰ø°ÊÅØ
            document.getElementById('fileCategory').textContent = data.category || '-';
            document.getElementById('fileSize').textContent = data.file_size || '-';
            document.getElementById('originalFilename').textContent = data.original_filename || '-';
            document.getElementById('systemFilename').textContent = data.system_filename || '-';
            document.getElementById('filePath').textContent = data.file_path || '-';
            
            // Êõ¥Êñ∞Êó∂Èó¥‰ø°ÊÅØ
            document.getElementById('uploadTime').textContent = data.upload_time || '-';
            document.getElementById('createTime').textContent = data.create_time || '-';
            document.getElementById('modifyTime').textContent = data.modify_time || '-';
            
            // Êõ¥Êñ∞Â±ûÊÄß‰ø°ÊÅØ
            document.getElementById('projectNumber').textContent = data.project_number || '-';
            document.getElementById('deviceName').textContent = data.device_name || '-';
            document.getElementById('contentLanguage').textContent = data.content_language || '-';
            document.getElementById('securityLevel').textContent = data.security_level || '-';
            document.getElementById('remarks').textContent = data.remarks || '-';
            
            // Â§ÑÁêÜ‰∫ßÂìÅ‰ø°ÊÅØÔºà‰ªÖÂõæÁâáÂíåËßÜÈ¢ëÊòæÁ§∫Ôºâ
            const productInfoCard = document.getElementById('productInfoCard');
            if (data.product_type || data.product_material) {
                productInfoCard.classList.remove('d-none');
                document.getElementById('productType').textContent = data.product_type || '-';
                document.getElementById('productMaterial').textContent = data.product_material || '-';
            } else {
                productInfoCard.classList.add('d-none');
            }
            
            // Â§ÑÁêÜÂõæÁâáÁâπÊúâÂ±ûÊÄß
            const imageInfoCard = document.getElementById('imageInfoCard');
            if (data.image_quality || data.image_number) {
                imageInfoCard.classList.remove('d-none');
                document.getElementById('imageQuality').textContent = data.image_quality || '-';
                document.getElementById('imageNumber').textContent = data.image_number || '-';
            } else {
                imageInfoCard.classList.add('d-none');
            }
            
            // Â§ÑÁêÜËßÜÈ¢ëÁâπÊúâÂ±ûÊÄß
            const videoInfoCard = document.getElementById('videoInfoCard');
            if (data.video_quality || data.video_number) {
                videoInfoCard.classList.remove('d-none');
                document.getElementById('videoQuality').textContent = data.video_quality || '-';
                document.getElementById('videoNumber').textContent = data.video_number || '-';
            } else {
                videoInfoCard.classList.add('d-none');
            }
            
            // ÊòæÁ§∫Êñá‰ª∂Áä∂ÊÄÅ
            const statusAlert = document.getElementById('fileStatusAlert');
            if (data.file_exists) {
                statusAlert.classList.remove('alert-danger');
                statusAlert.classList.add('alert-success');
                statusAlert.innerHTML = '<i class="bi bi-check-circle"></i> Êñá‰ª∂Áä∂ÊÄÅÊ≠£Â∏∏ÔºåÂèØ‰ª•‰∏ãËΩΩÂíå‰ΩøÁî®';
            } else {
                statusAlert.classList.remove('alert-success');
                statusAlert.classList.add('alert-danger');
                statusAlert.innerHTML = '<i class="bi bi-exclamation-triangle"></i> Ë≠¶ÂëäÔºöÁâ©ÁêÜÊñá‰ª∂Â∑≤‰∏çÂ≠òÂú®ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ë∑ØÂæÑ';
            }
            statusAlert.classList.remove('d-none');
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('fileInfoLoading').classList.add('d-none');
            document.getElementById('fileInfoContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-circle"></i> Âä†ËΩΩÊñá‰ª∂ËØ¶ÊÉÖÂ§±Ë¥•Ôºö${error.message}
                </div>
            `;
            document.getElementById('fileInfoContent').classList.remove('d-none');
        });
}

function deleteFile(fileId, fileName) {
    var confirmMessage = 'Á°ÆÂÆöË¶ÅÂà†Èô§Êñá‰ª∂ "' + fileName + '" ÂêóÔºü\n\n‚ö†Ô∏è Ê≥®ÊÑèÔºöËøôÂ∞ÜÂêåÊó∂Âà†Èô§Ôºö\n‚Ä¢ Êï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊñá‰ª∂ËÆ∞ÂΩï\n‚Ä¢ Á£ÅÁõò‰∏äÁöÑÁâ©ÁêÜÊñá‰ª∂\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ';
    
    if (confirm(confirmMessage)) {
        // ÂàõÂª∫Ë°®ÂçïÂπ∂Êèê‰∫§
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = '/files/delete/' + fileId;
        
        // Ê∑ªÂä†Âà†Èô§Áâ©ÁêÜÊñá‰ª∂ÁöÑÂèÇÊï∞ÔºàÈªòËÆ§‰∏∫trueÔºâ
        var deletePhysicalInput = document.createElement('input');
        deletePhysicalInput.type = 'hidden';
        deletePhysicalInput.name = 'delete_physical';
        deletePhysicalInput.value = 'true';
        form.appendChild(deletePhysicalInput);
        
        // Ê∑ªÂä†CSRF‰ª§ÁâåÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ
        var csrfToken = document.querySelector('meta[name=csrf-token]');
        if (csrfToken) {
            var csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrf_token';
            csrfInput.value = csrfToken.getAttribute('content');
            form.appendChild(csrfInput);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}

// Ëá™Âä®Êèê‰∫§ÊêúÁ¥¢Ë°®Âçï
document.querySelector('input[name="search"]').addEventListener('input', function() {
    clearTimeout(this.searchTimeout);
    var form = this.form;
    this.searchTimeout = setTimeout(function() {
        form.submit();
    }, 500);
});
</script>

<style>
.table th {
    border-top: none;
    font-weight: 600;
    font-size: 0.875rem;
    color: #495057;
}

.table td {
    vertical-align: middle;
    border-color: #f8f9fa;
}

.btn-group-sm .btn {
    padding: 0.25rem 0.4rem;
    font-size: 0.75rem;
}

.badge {
    font-size: 0.7rem;
}

.card-header {
    background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #dee2e6;
}

@media (max-width: 768px) {
    .table-responsive {
        font-size: 0.875rem;
    }
    
    .btn-group-sm .btn {
        padding: 0.2rem 0.3rem;
        font-size: 0.7rem;
    }
}

/* Êñá‰ª∂ËØ¶ÊÉÖÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
.modal-body .card {
    border: none;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
}

.modal-body .card-header {
    background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #dee2e6;
}

.modal-body .card-header h6 {
    color: #495057;
    font-weight: 600;
}

.modal-body .small {
    color: #6c757d;
}

.modal-body .fw-bold {
    color: #212529;
}

.modal-body .alert {
    margin-bottom: 0;
}

.modal-body .bi {
    margin-right: 0.5rem;
}
</style>
{% endblock %} 