# 文件保存功能使用指南

## 📁 新功能概述

系统已升级为**基于路径的文件管理**模式，用户可以指定文件的保存位置，系统将记录文件的绝对路径信息。

## 🔧 主要改进

### 1. 灵活的保存位置选择
- **预设目录**：我的文档、下载文件夹、桌面、E盘文件夹
- **自定义路径**：支持用户输入任意有效的绝对路径
- **自动创建**：不存在的目录将自动创建

### 2. 智能文件处理
- **文件名安全化**：自动处理特殊字符
- **智能命名系统**：使用日期序号格式（YYYYMMDD-NNNNN.ext）
- **冲突处理**：极少情况下自动添加额外序号
- **路径验证**：实时验证路径格式的正确性

### 3. 完整的元数据记录
- **绝对路径**：数据库记录文件的完整路径
- **原始文件名**：保留用户上传时的原始文件名
- **系统文件名**：使用日期序号格式的实际存储文件名
- **双重映射**：原始名称与系统名称的完整映射关系

## 📂 文件命名系统

### 自动命名规则
系统采用**基于日期的序号命名**方式：

**格式**：`YYYYMMDD-NNNNN.ext`

**示例**：
- 用户上传：`项目报告.doc` → 系统保存：`20250603-00001.doc`
- 用户上传：`测试图片.jpg` → 系统保存：`20250603-00002.jpg`
- 用户上传：`演示视频.mp4` → 系统保存：`20250603-00003.mp4`

### 命名优势
- ✅ **时间可追溯**：文件名包含上传日期
- ✅ **唯一性保证**：避免文件名冲突
- ✅ **排序友好**：按日期自然排序
- ✅ **系统兼容**：无特殊字符，跨平台兼容
- ✅ **原名保留**：数据库中完整保存原始文件名

### 序号规则
- **按用户分组**：每个用户独立计数
- **按日期重置**：每天从00001开始
- **自动递增**：同一天内依次递增
- **5位补零**：确保文件名长度一致

## 📱 使用方法

### 高级上传（三步式）

#### 第一步：选择文件类型
- 🗂️ **文件**：文档类型（PDF、Word、Excel等）
- 🖼️ **图片**：图像文件（JPG、PNG、GIF等）
- 🎬 **视频**：视频文件（MP4、AVI、MOV等）

#### 第二步：填写属性信息
根据文件类型填写相应的元数据：

**通用字段（所有类型）：**
- 项目号（必填）
- 设备名称（必填）
- 语言（必填）
- 保密等级（必填）
- 备注（可选）

**图片/视频额外字段：**
- 产品类型（必填）
- 产品物料（必填）
- 质量等级（必填）
- 编号（必填）

#### 第三步：选择位置和文件
1. **选择保存位置**：
   - 从预设目录中选择
   - 或选择"自定义位置"输入路径
   
2. **选择文件**：
   - 拖拽文件到上传区域
   - 或点击"选择文件"按钮

3. **确认并上传**：
   - 系统显示完整的保存路径
   - 点击"开始上传"完成保存

### 简单上传

对于快速上传，系统提供简单模式：
- 自动保存到用户的下载文件夹
- 自动识别文件类型
- 只需填写文件描述（可选）

## 🔍 文件管理

### 查看文件
- 文件列表显示完整的路径信息
- 支持按文件类型、项目号、设备名等搜索
- 显示文件的保密等级和其他属性

### 下载文件
- 点击下载按钮从原始路径获取文件
- 保持原始文件名进行下载
- 如果原始路径文件不存在，系统会提示错误

### 删除文件
- **默认行为**：同时删除数据库记录和物理文件
- **安全确认**：删除前会显示详细的确认对话框
- **不可恢复**：删除操作是永久性的，请谨慎操作
- **权限检查**：只能删除自己上传的文件

**删除确认信息示例：**
```
确定要删除文件 "test.pdf" 吗？

⚠️ 注意：这将同时删除：
• 数据库中的文件记录
• 磁盘上的物理文件

此操作不可恢复！
```

## ⚠️ 注意事项

### 路径要求
- 必须使用**绝对路径**（如：`D:\MyFiles\Projects`）
- 支持Windows路径格式
- 确保有对应目录的写入权限

### 文件管理建议
- 建议使用易于访问的目录
- 定期检查文件路径的有效性
- 重要文件建议备份到多个位置

### 兼容性说明
- 旧数据会自动恢复到数据库中
- 支持新旧数据的混合管理
- 简单上传模式向下兼容

## 📊 功能对比

| 功能 | 旧版本 | 新版本 |
|------|--------|--------|
| 文件存储 | 复制到uploads目录 | 保存到用户指定位置 |
| 路径管理 | 相对路径 | 绝对路径 |
| 目录选择 | 固定目录 | 用户自定义 |
| 文件冲突 | UUID重命名 | 智能序号添加 |
| 元数据记录 | 基础信息 | 完整属性 + 路径信息 |
| 删除操作 | 只删除数据库记录 | 同时删除数据库记录和物理文件 |
| 删除确认 | 简单提示 | 详细警告和说明 |

## 🚀 使用场景

### 企业文档管理
- 按项目分类保存到不同目录
- 记录详细的项目和设备信息
- 支持保密等级分类

### 个人文件整理
- 保存到个人习惯的目录结构
- 自动维护文件索引
- 便于后续查找和管理

### 团队协作
- 共享目录中的文件管理
- 统一的元数据标准
- 便于权限控制和追踪

---

## 📞 技术支持

如有问题，请联系系统管理员或查看应用程序日志。

**系统版本**：FMS v2.1 - 路径管理版 + 智能删除  
**更新时间**：2025年6月3日  
**管理员账号**：admin / 123456 